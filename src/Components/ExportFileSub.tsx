import { useNavigate } from "react-router-dom";
import { Document, Packer, Paragraph, TextRun } from "docx";
import { saveAs } from "file-saver";

// üîΩ —Ç–≤–æ–∏ —Å—É–±—Ç–∏—Ç—Ä—ã
const subtitles = [
    { start: 27.2, end: 33.42, lang: "ru", text: { ru: "–ú—ã —Ä–∞–¥—ã –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≥–æ—Å—Ç–µ–π –∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤–æ—Å—å–º–æ–≥–æ –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–≥–æ –ó–æ–ª–æ—Ç–∞—Ä–¥—ã–Ω—Å–∫–æ–≥–æ —Ñ–æ—Ä—É–º–∞.", tt: "–°–∏–≥–µ–∑–µ–Ω—á–µ –•–∞–ª—ã–∫–∞—Ä–∞ –ê–ª—Ç—ã–Ω –£—Ä–¥–∞ —Ñ–æ—Ä—É–º—ã–Ω–¥–∞ –∫–∞—Ç–Ω–∞—à—É—á—ã–ª–∞—Ä–Ω—ã “ª”ô–º –∫—É–Ω–∞–∫–ª–∞—Ä–Ω—ã –∫–∞—Ä—à—ã –∞–ª—É—ã–±—ã–∑–≥–∞ —à–∞—Ç–±—ã–∑.", ar: "" } },
    { start: 33.42, end: 43.0, lang: "ru", text: { ru: "–û–Ω–∏ –≤–Ω–æ—Å—è—Ç —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–∫–ª–∞–¥ –≤ –∏–∑—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∫–∞–∫ —Ç–∞—Ç–∞—Ä—Å–∫–æ–≥–æ –Ω–∞—Ä–æ–¥–∞, —Ç–∞–∫ –∏ –Ω–∞—Ä–æ–¥–æ–≤ –†–µ—Å–ø—É–±–ª–∏–∫–∏ –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω –∏ –≤ —Ü–µ–ª–æ–º –∏—Å—Ç–æ—Ä–∏–∏ –†–æ—Å—Å–∏–∏.", tt: "–ê–ª–∞—Ä —Ç–∞—Ç–∞—Ä —Ö–∞–ª–∫—ã–Ω—ã“£, –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω –†–µ—Å–ø—É–±–ª–∏–∫–∞—Å—ã —Ö–∞–ª—ã–∫–ª–∞—Ä—ã–Ω—ã“£ “ª”ô–º –≥–æ–º—É–º”ô–Ω, –†–æ—Å—Å–∏—è —Ç–∞—Ä–∏—Ö—ã–Ω—ã“£ —Ç–∞—Ä–∏—Ö—ã–Ω ”©–π—Ä”ô–Ω“Ø–≥”ô –∑—É—Ä ”©–ª–µ—à –∫–µ—Ä—Ç”ô.", ar: "" } },
    { start: 46.7, end: 57.5, lang: "ru", text: { ru: "–õ—É—Å–¥–∂—É—á–∏ –∏–ª–∏ –ó–æ–ª–æ—Ç–∞—è –û—Ä–¥–∞ —è–≤–ª—è–µ—Ç—Å—è –Ω–µ–æ—Ç–ª–µ–≤–∞–µ–º–æ–π —á–∞—Å—Ç—å—é —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ –∫—É–ª—å—Ç—É—Ä–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏ —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –æ–±—â–µ—Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ –ø—Ä–æ—à–ª–æ–≥–æ.", tt: "–õ—É—Å–¥–∂—É—á–∏, —è–≥—ä–Ω–∏ –ê–ª—Ç—ã–Ω –£—Ä–¥–∞, –†–æ—Å—Å–∏—è –º”ô–¥”ô–Ω–∏—è—Ç–µ–Ω–µ“£ –∞–µ—Ä—ã–ª–≥—ã—Å—ã–∑ ”©–ª–µ—à–µ –±—É–ª—ã–ø —Ç–æ—Ä–∞ “ª”ô–º –≥–æ–º—É–º—Ä–æ—Å—Å–∏—è “Ø—Ç–∫”ô–Ω–µ–Ω–µ“£ ”©–ª–µ—à–µ –±—É–ª—ã–ø —Ç–æ—Ä–∞.", ar: "" } },
    { start: 59.7, end: 64.18, lang: "ar", text: { ar: "ŸÅŸä ÿßŸÑŸàÿßŸÇÿπ ÿ£ŸÜÿß ŸÖÿ≥ÿ±Ÿàÿ± ÿ¨ÿØÿßŸã ŸÑŸÑŸÖÿ¥ÿßÿ±ŸÉÿ© ŸÅŸä Ÿáÿ∞ÿß ÿßŸÑŸÖÿ§ÿ™ŸÖÿ± ÿßŸÑÿØŸàŸÑŸä", ru: "", tt: "" } },
    { start: 64.18, end: 73.0, lang: "ar", text: { ar: "ŸàŸÑŸÇÿØ ÿ≠ÿ≥ŸÜŸä ÿßŸÑÿ¥ÿ±ŸÅ ÿ®ÿ£ŸÜ ÿ£ŸÉŸàŸÜ ŸÖŸÜ ÿßŸÑÿ¥ÿÆÿµŸäÿßÿ™ ÿßŸÑÿ™Ÿä ÿ¥ÿØÿ™ ÿßŸÑÿ±ÿ≠ÿßŸÑ ŸÖŸÜ ÿ£ŸÇÿµŸâ ÿßŸÑÿ∫ÿ±ÿ® ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖŸä ÿ•ŸÑŸâ ÿ£ÿ≥Ÿäÿ± Ÿàÿ≥ÿ∑ÿ© Ÿàÿ®ÿßŸÑÿ∂ÿ®ÿ∑ ÿ•ŸÑŸâ ŸÇÿ≤ÿßŸÜ", ru: "", tt: "" } },
    { start: 74.0, end: 87.3, lang: "ru", text: { ru: "–î–ª—è –º–µ–Ω—è, –≤–æ-–ø–µ—Ä–≤—ã—Ö, –ø—Ä–æ–∏–∑–≤–µ–ª–æ —Å–µ—Ä—å–µ–∑–Ω–æ–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, —Å—Ä–µ–¥–∏ –Ω–∏—Ö –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–æ–ª—å—à–æ–π —Å–æ—Å—Ç–∞–≤ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ª—é–¥–µ–π, –∏—Å—Ç–æ—Ä–∏–∫–æ–≤. –ö–æ–≥–¥–∞ —É —á–µ–ª–æ–≤–µ–∫–∞ –µ—Å—Ç—å —Å–∏–ª—å–Ω—ã–µ –∫–æ—Ä–Ω–∏, –æ–Ω –≤—Å–µ–≥–¥–∞ –≤ —ç—Ç–æ–π –∂–∏–∑–Ω–∏ –±—É–¥–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ —Å—Ç–æ—è—Ç—å –Ω–∞ —Å–≤–æ–∏—Ö –Ω–æ–≥–∞—Ö.", tt: "–ú–∏–Ω–µ–º ”©—á–µ–Ω, –±–µ—Ä–µ–Ω—á–µ–¥”ô–Ω, –∫–∞—Ç–Ω–∞—à—É—á—ã–ª–∞—Ä–Ω—ã“£ —Å–∞–Ω—ã, —à—É–ª –∏—Å”ô–ø—Ç”ô–Ω –±–∏–ª–≥–µ–ª–µ –∫–µ—à–µ–ª”ô—Ä, —Ç–∞—Ä–∏—Ö—á—ã–ª–∞—Ä —Å–∞–Ω—ã –¥–∞ —à–∞–∫—Ç—ã–π –∑—É—Ä –∏–¥–µ, —á”©–Ω–∫–∏ –∫–µ—à–µ–Ω–µ“£ —Ç–∞–º—ã—Ä–ª–∞—Ä—ã –Ω—ã–∫ –±—É–ª–≥–∞—á, —É–ª –±—É —Ç–æ—Ä–º—ã—à—Ç–∞ “ª”ô—Ä–≤–∞–∫—ã—Ç “Ø–∑ –∞—è–∫–ª–∞—Ä—ã–Ω–¥–∞ —ã—à–∞–Ω—ã—á –±–µ–ª”ô–Ω —Ç–æ—Ä–∞—á–∞–∫.", ar: "" } },
    { start: 95.0, end: 98.4, lang: "ru", text: { ru: "–í –∏—Å—Ç–æ—Ä–∏–∏ –Ω–µ –±—ã–≤–∞–µ—Ç –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ —Ö–æ—Ä–æ—à–µ–≥–æ –∏–ª–∏ –ø–ª–æ—Ö–æ–≥–æ —è–≤–ª–µ–Ω–∏—è.", tt: "–¢–∞—Ä–∏—Ö—Ç–∞ –±–µ—Ä–Ω–∏–Ω–¥–∏ –¥”ô —è—Ö—à—ã —è–∫–∏ –Ω–∞—á–∞—Ä –∫“Ø—Ä–µ–Ω–µ—à–ª”ô—Ä —é–∫.", ar: "" } },
    { start: 99.4, end: 105.0, lang: "ru", text: { ru: "–ú—ã –∏–∑ –ª—é–±–æ–≥–æ —è–≤–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –∏–∑–≤–ª–µ–∫–∞—Ç—å —É—Ä–æ–∫–∏ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∏–¥—Ç–∏ –¥–∞–ª—å—à–µ.", tt: "–ê–ª–≥–∞ —Ç–∞–±–∞ –±–∞—Ä—ã—Ä ”©—á–µ–Ω, –±–µ–∑ “ª”ô—Ä–∫–∞–π—Å—ã –∫“Ø—Ä–µ–Ω–µ—à—Ç”ô–Ω —Å–∞–±–∞–∫ –∞–ª—ã—Ä–≥–∞ —Ç–∏–µ—à.", ar: "" } },
    { start: 114.0, end: 129.2, lang: "ru", text: { ru: "–ó–æ–ª–æ—Ç–æ-–ê—Ä–¥–µ–Ω—Å–∫–∏–π —Ñ–æ—Ä—É–º ‚Äì —ç—Ç–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –∏–º–µ–µ—Ç —É–∂–µ –≤ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–º –º–∞—Å—à—Ç–∞–±–µ —Ö–æ—Ä–æ—à–∏–π –æ—Ç–∫–ª–∏–∫, —Ö–æ—Ä–æ—à–æ –∏–∑–≤–µ—Å—Ç–Ω–æ–µ –∏, –Ω–∞–≤–µ—Ä–Ω–æ–µ, –æ–¥–Ω–æ –∏–∑ –≥–ª–∞–≤–Ω—ã—Ö –Ω–∞—É—á–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –ø–æ —Ç–µ–º–∞—Ç–∏–∫–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ä–µ–¥–Ω–∏—Ö –≤–µ–∫–æ–≤ –µ–≤—Ä–∞–∑–∏–π—Å–∫–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞.", tt: "–ê–ª—Ç—ã–Ω-–ê—Ä–¥—ç–Ω —Ñ–æ—Ä—É–º—ã - —Ö–∞–ª—ã–∫–∞—Ä–∞ –¥”ô—Ä”ô“ó”ô–¥”ô —è—Ö—à—ã –∫–∞–±—É–ª –∏—Ç–µ–ª–≥”ô–Ω, —è—Ö—à—ã –±–∏–ª–≥–µ–ª–µ “ª”ô–º, –±”ô–ª–∫–∏, –ï–≤—Ä–∞–∑–∏—è –∫–∏“£–ª–µ–≥–µ–Ω–µ“£ —É—Ä—Ç–∞ –≥–∞—Å—ã—Ä–ª–∞—Ä —Ç–∞—Ä–∏—Ö—ã —Ç–µ–º–∞—Å—ã–Ω–∞ –±–∞–≥—ã—à–ª–∞–Ω–≥–∞–Ω —Ç”©–ø —Ñ”ô–Ω–Ω–∏ —á–∞—Ä–∞–ª–∞—Ä–Ω—ã“£ –±–µ—Ä—Å–µ.", ar: "" } },
    { start: 133.6, end: 139.04, lang: "ru", text: { ru: "–ó–æ–ª–æ—Ç–∞—è –û—Ä–¥–∞ –∏ –õ–æ—Å-–î–∂—É—á–∏ ‚Äì —ç—Ç–æ —Ç–µ –æ—Å–Ω–æ–≤—ã, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö", tt: "–ê–ª—Ç—ã–Ω –£—Ä–¥–∞ “ª”ô–º –õ–æ—Å-–î–∂—É—á–∏ - –±—É –Ω–∏–≥–µ–∑–ª”ô—Ä.", ar: "" } },
    { start: 139.04, end: 141.4, lang: "ru", text: { ru: "–ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –º–Ω–æ–≥–∏—Ö –Ω–∞—à–∏—Ö —Å—Ç—Ä–∞–Ω.", tt: "–ö“Ø–ø –∫–µ–Ω”ô –∏–ª–ª”ô—Ä–µ–±–µ–∑–Ω–µ“£ –¥”ô“Ø–ª”ô—Ç—á–µ–ª–µ–≥–µ —Ç”©–∑–µ–ª–≥”ô–Ω.", ar: "" } },
    { start: 162.5, end: 167.84, lang: "ru", text: { ru: "–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π –ó–æ–ª–æ—Ç–∞—Ä–¥—ã–Ω—Å–∫–∏–π —Ñ–æ—Ä—É–º ‚Äì —ç—Ç–æ —É–∂–µ —Ç–∞–∫–æ–π –±—Ä–µ–Ω–¥ –¥–ª—è –≤—Å–µ—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤,", tt: "–•–∞–ª—ã–∫–∞—Ä–∞ –ê–ª—Ç—ã–Ω –£—Ä–¥–∞ —Ñ–æ—Ä—É–º—ã –∏–Ω–¥–µ –±–∞—Ä–ª—ã–∫ –±–µ–ª–≥–µ—á–ª”ô—Ä ”©—á–µ–Ω —à—É–Ω–¥—ã–π –±—Ä–µ–Ω–¥.", ar: "" } },
    { start: 168.04, end: 171.66, lang: "ru", text: { ru: "–∫—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –∑–æ–ª–æ—Ç–∞—Ä–¥—ã–Ω—Å–∫–∏–º –ø–µ—Ä–∏–æ–¥–æ–º, –ø–µ—Ä–∏–æ–¥–æ–º —Ç–∞—Ç–∞—Ä—Å–∫–∏—Ö —Ö–∞–Ω—Ü–µ–≤,", tt: "–ê–ª—Ç—ã–Ω —á–æ—Ä—ã, —Ç–∞—Ç–∞—Ä —Ö–∞–Ω–Ω–∞—Ä—ã —á–æ—Ä—ã,", ar: "" } },
    { start: 171.78, end: 174.5, lang: "ru", text: { ru: "–¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è —Å—Ä–µ–¥–Ω–∏–º–∏ –≤–µ–∫–∞–º–∏.", tt: "—É—Ä—Ç–∞ –≥–∞—Å—ã—Ä–ª–∞—Ä –±–µ–ª”ô–Ω —à”©–≥—ã–ª—å–ª”ô–Ω“Ø—á–µ–ª”ô—Ä ”©—á–µ–Ω.", ar: "" } },
    { start: 176.4, end: 184.0, lang: "ru", text: { ru: "–ò –º—ã, –∫–æ–Ω–µ—á–Ω–æ, –∫–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä—ã, –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤—ã –ø—Ä–∏–Ω—è—Ç—å –Ω–∞—à–∏—Ö —É–≤–∞–∂–∞–µ–º—ã—Ö –∫–æ–ª–ª–µ–≥ –≤ –ö–∞–∑–∞–Ω–∏, –≤ –ë—É–ª–≥–∞—Ä–∏–∏, –≤ –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω–µ.", tt: "“∫”ô–º –±–µ–∑, ”ô–ª–±”ô—Ç—Ç”ô, –æ–µ—à—Ç—ã—Ä—É—á—ã–ª–∞—Ä –±—É–ª–∞—Ä–∞–∫, –ö–∞–∑–∞–Ω–¥–∞, –ë–æ–ª–≥–∞—Ä–∏—è–¥”ô, –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω–¥–∞ —Ö”©—Ä–º”ô—Ç–ª–µ —Ö–µ–∑–º”ô—Ç—Ç”ô—à–ª”ô—Ä–µ–±–µ–∑–Ω–µ –∫–∞–±—É–ª –∏—Ç”ô—Ä–≥”ô “ª”ô—Ä–≤–∞–∫—ã—Ç ”ô–∑–µ—Ä.", ar: "" } },
];

const DownloadIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
         viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"
         strokeLinecap="round" strokeLinejoin="round" className="mr-3">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
        <polyline points="7 10 12 15 17 10"/>
        <line x1="12" y1="15" x2="12" y2="3"/>
    </svg>
);

const ExportFileSub = () => {
    const navigate = useNavigate();

    const handleExportVideo = () => {
        const videoUrl = localStorage.getItem("uploadedVideo");
        if (!videoUrl) {
            alert("–í–∏–¥–µ–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ localStorage");
            return;
        }
        const link = document.createElement("a");
        link.href = videoUrl;
        link.download = "video.mp4";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    };

    const handleDownloadSubtitles = async () => {
        const doc = new Document({
            sections: [
                {
                    properties: {},
                    children: subtitles.map((sub, index) => {
                        const timeRange = `[${sub.start.toFixed(2)} - ${sub.end.toFixed(2)}]`;

                        const lines = [
                            new Paragraph({
                                children: [
                                    new TextRun({ text: `${index + 1}. ${timeRange}`, bold: true }),
                                ],
                            }),
                        ];

                        Object.entries(sub.text).forEach(([lang, value]) => {
                            if (value) {
                                lines.push(
                                    new Paragraph({
                                        children: [new TextRun({ text: `${lang}: ${value}` })],
                                    })
                                );
                            }
                        });

                        return lines;
                    }).flat(),
                },
            ],
        });

        const blob = await Packer.toBlob(doc);
        saveAs(blob, "subtitles.docx");
    };

    return (
        <div className="h-full flex flex-col items-center bg-gray-50">
            <div className="w-full max-w-6xl mb-8">
                <div className="w-full max-w-6xl px-6 py-4">
                    <button onClick={() => navigate("/edit")} className="text-blue-600">‚Üê –ù–∞–∑–∞–¥</button>
                </div>

                <div className="flex flex-row justify-center gap-10">
                    <div className="flex justify-center items-center gap-4 mt-30 mb-20">
                        <button
                            onClick={handleExportVideo}
                            className="flex items-center px-10 py-5 rounded-2xl bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold text-lg shadow-lg hover:shadow-2xl hover:brightness-110 transition"
                        >
                            <DownloadIcon/>
                            –°–∫–∞—á–∞—Ç—å –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω–æ–µ –≤–∏–¥–µ–æ
                        </button>
                    </div>

                    <div className="flex justify-center items-center gap-4 mt-30 mb-20">
                        <button
                            onClick={handleDownloadSubtitles}
                            className="flex items-center px-10 py-5 rounded-2xl bg-white text-green-500 font-bold text-lg shadow-lg hover:shadow-2xl hover:bg-gray-100 transition"
                        >
                            <DownloadIcon/>
                            –°–∫–∞—á–∞—Ç—å —Å—É–±—Ç–∏—Ç—Ä—ã –≤ .docx
                        </button>
                    </div>
                </div>
            </div>

            <div
                className="w-full max-w-4xl p-12 border-2 border-dashed border-gray-300 rounded-xl text-center text-gray-500 text-lg">
                –ú–µ—Å—Ç–æ –¥–ª—è –≤–∞—à–µ–π —Ä–µ–∫–ª–∞–º—ã
            </div>
        </div>
    );
};

export default ExportFileSub;
